---
# https://github.com/neovim/neovim/wiki/Installing-Neovim#ubuntu
- name: Add the repository of Neovim
  apt_repository:
    repo: "ppa:neovim-ppa/stable"
    update_cache: yes
  become: yes
- name: Install Neovim
  apt:
    name: neovim
    update_cache: yes
    cache_valid_time: 3600
    install_recommends: no
  become: yes
- name: Update symlinks related to vi/vim
  alternatives:
    name: "{{ item.name }}"
    link: "{{ item.link }}"
    path: /usr/bin/nvim
    priority: 60
  with_items:
    - { name: "vi", link: "/usr/bin/vi" }
    - { name: "vim", link: "/usr/bin/vim" }
    - { name: "editor", link: "/usr/bin/editor" }
  become: yes

- name: Ensure default XDG_CONFIG_HOME exists
  file:
    path: "{{ ansible_env.HOME }}/.config"
    state: directory
- name: Copy Neovim settings
  copy:
    src: "../resources/nvim"
    dest: "{{ ansible_env.HOME }}/.config"
- name: Install Neovim python client
  pip:
    name: pynvim
    executable: "{{ pip3_executable }}"
    extra_args: --user
